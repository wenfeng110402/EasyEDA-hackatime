<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hackatime Settings</title>
	<style>
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
			padding: 20px;
			background: #f5f5f5;
			color: #333;
		}
		h1 {
			font-size: 18px;
			margin-bottom: 16px;
			color: #222;
		}
		.form-group {
			margin-bottom: 16px;
		}
		label {
			display: block;
			font-size: 13px;
			font-weight: 500;
			margin-bottom: 6px;
			color: #555;
		}
		input[type="text"] {
			width: 100%;
			padding: 10px 12px;
			border: 1px solid #ccc;
			border-radius: 4px;
			font-size: 14px;
			transition: border-color 0.2s;
		}
		input[type="text"]:focus {
			outline: none;
			border-color: #4a90d9;
		}
		.hint {
			font-size: 11px;
			color: #888;
			margin-top: 4px;
		}
		.btn-row {
			display: flex;
			justify-content: flex-end;
			gap: 10px;
			margin-top: 20px;
		}
		button {
			padding: 10px 20px;
			font-size: 14px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			transition: background 0.2s;
		}
		button.primary {
			background: #4a90d9;
			color: #fff;
		}
		button.primary:hover {
			background: #357abd;
		}
		button.secondary {
			background: #e0e0e0;
			color: #333;
		}
		button.secondary:hover {
			background: #d0d0d0;
		}
		.status {
			font-size: 12px;
			margin-top: 12px;
			padding: 8px;
			border-radius: 4px;
			display: none;
		}
		.status.success {
			display: block;
			background: #d4edda;
			color: #155724;
		}
		.status.error {
			display: block;
			background: #f8d7da;
			color: #721c24;
		}
	</style>
</head>
<body>
	<h1>Hackatime Settings</h1>

	<div class="form-group">
		<label for="apiKey">API Key</label>
		<input type="text" id="apiKey" placeholder="Enter your Hackatime API Key">
		<div class="hint">Get your API key from <a href="https://hackatime.hackclub.com/settings" target="_blank">hackatime.hackclub.com/settings</a></div>
	</div>

	<div class="form-group">
		<label for="apiUrl">API URL (optional)</label>
		<input type="text" id="apiUrl" placeholder="https://hackatime.hackclub.com/api/hackatime/v1">
		<div class="hint">Leave empty to use the default Hackatime server</div>
	</div>

	<div class="btn-row">
		<button class="secondary" id="cancelBtn">Cancel</button>
		<button class="primary" id="saveBtn">Save</button>
	</div>

	<div class="status" id="status"></div>

	<script>
		const DEFAULT_API_URL = 'https://hackatime.hackclub.com/api/hackatime/v1';

		const apiKeyInput = document.getElementById('apiKey');
		const apiUrlInput = document.getElementById('apiUrl');
		const saveBtn = document.getElementById('saveBtn');
		const cancelBtn = document.getElementById('cancelBtn');
		const statusDiv = document.getElementById('status');

		// Load existing settings
		async function loadSettings() {
			try {
				const apiKey = await eda.sys_Storage.getExtensionUserConfig('apiKey');
				const apiUrl = await eda.sys_Storage.getExtensionUserConfig('apiURL');

				if (apiKey) apiKeyInput.value = apiKey;
				if (apiUrl && apiUrl !== DEFAULT_API_URL) apiUrlInput.value = apiUrl;
			} catch (e) {
				console.error('Error loading settings:', e);
			}
		}

		// Save settings
		async function saveSettings() {
			const apiKey = apiKeyInput.value.trim();
			const apiUrl = apiUrlInput.value.trim() || DEFAULT_API_URL;

			if (!apiKey) {
				showStatus('Please enter your API Key.', 'error');
				return;
			}

			try {
				await eda.sys_Storage.setExtensionUserConfig('apiKey', apiKey);
				await eda.sys_Storage.setExtensionUserConfig('apiURL', apiUrl);

				showStatus('Settings saved successfully!', 'success');

				// Close iframe after a short delay
				setTimeout(() => {
					eda.sys_IFrame.closeIFrame();
				}, 800);
			} catch (e) {
				console.error('Error saving settings:', e);
				showStatus('Failed to save settings.', 'error');
			}
		}

		function showStatus(message, type) {
			statusDiv.textContent = message;
			statusDiv.className = 'status ' + type;
		}

		saveBtn.addEventListener('click', saveSettings);
		cancelBtn.addEventListener('click', () => {
			eda.sys_IFrame.closeIFrame();
		});

		// Load settings on page load
		loadSettings();
	</script>
</body>
</html>
